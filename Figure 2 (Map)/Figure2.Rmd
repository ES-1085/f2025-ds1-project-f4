---
title: "Figure2"
output: html_document
---

```{r loading_libraries}
# install.packages(c("ggplot2", "tidyverse", "gganimate", "rnaturalearth", "rnaturalearthdata"))

library(gganimate)
library(ggplot2)
library(dplyr)
library(rnaturalearth)
library(rnaturalearthdata)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)         

world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf")

```

``` {r gdppc-across-time}
library(ggplot2)
library(gganimate)
library(sf)
library(dplyr)
library(viridis)
library(av)
library(rnaturalearth)

world <- ne_countries(scale = "medium", returnclass = "sf")

df_clean <- df %>%
  filter(year >= 1960, year <= 2024)

world_data <- world %>%
  left_join(df_clean, by = c("iso_a3" = "iso3c"))

p <- ggplot(world_data) +
  geom_sf(aes(fill = gdppc), color = "gray30", size = 0.2) +
  scale_fill_viridis_c(
    option = "plasma",
    na.value = "lightgray",
    name = "GDP per Capita",
    limits = c(0, 100000),   
  ) +
  labs(
    title = "World GDP per Capita",
    caption = "Source: V-Dem Dataset v13; World Bank WDI"
  ) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
  axis.ticks = element_blank(),
    legend.position = "left",
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  ) +
  transition_states(
    year,
    transition_length = 1,
    state_length = 1
  ) +
  ease_aes("linear")

animate(
  p,
  nframes = 200,
  fps = 10,
  width = 900,
  height = 600,
  renderer = av_renderer("world_gdppc_1960_2024.mp4")
)
```

``` {r map-of-polyarchy}
pal <- colorNumeric("YlGnBu", domain = df$value, na.color = "lightgrey")

leaflet(world_data) |>
  addTiles() |>
  addPolygons(
    fillColor = ~pal(gdp),
    color = "white",
    weight = 1,
    popup = ~paste(name, "<br>gdp:", gdp)
) |>
  setView(lng = 0, lat = 20, zoom = 2)
```

```{r gdp-2024-map}
year_to_plot <- 2024
map_data_year <- df |> 
  filter(year == year_to_plot)

world <- ne_countries(scale = "medium", returnclass = "sf")

world_data <- world %>%
  left_join(map_data_year, by = c("iso_a3" = "country_text_id"))

ggplot(data = world_data) +
  geom_sf(aes(fill = gdppc), color = "gray30", size = 0.2) +
  scale_fill_viridis_c(na.value = "lightgray",
                       name = "GDP per Capita") +
  labs(
    title = paste("World GDP per Capita in", year_to_plot)
  ) +
  theme_minimal() +
  theme(
  axis.text = element_blank(),
  axis.ticks = element_blank(),
  legend.position = "left",
  plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
)
```

```{r Democracy-2024-map}
year_to_plot <- 2024
map_data_year <- df |> 
  filter(year == year_to_plot)

world <- ne_countries(scale = "medium", returnclass = "sf")

world_data <- world %>%
  left_join(map_data_year, by = c("iso_a3" = "country_text_id"))

ggplot(data = world_data) +
  geom_sf(aes(fill = libdem), color = "gray30", size = 0.2) +
  scale_fill_viridis_c(na.value = "lightgray",
                       name = "Liberal Dem. Index") +
  labs(
    title = paste("World Liberal Democracy in", year_to_plot)
  ) +
  theme_minimal() +
  theme(
  axis.text = element_blank(),
  axis.ticks = element_blank(),
  legend.position = "left",
  plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
)
```

``` {r Liberal-democracy-across-time}
# Install once if you haven't already:
# install.packages(c("ggplot2", "gganimate", "sf", "dplyr", "viridis", "av"))

library(ggplot2)
library(gganimate)
library(sf)
library(dplyr)
library(viridis)
library(av)
library(rnaturalearth)   # for ne_countries

# Get world polygons
world <- ne_countries(scale = "medium", returnclass = "sf")

# Filter your V-Dem data to the desired years
df <- df %>%
  filter(year >= 1960 & year <= 2024)

# Join V-Dem data to world polygons
world_data <- world %>%
  left_join(df, by = c("iso_a3" = "iso3c"))

# Build the animation plot
p <- ggplot(world_data) +
  geom_sf(aes(fill = libdem), color = "gray30", size = 0.2) +
  scale_fill_viridis_c(
    option = "plasma",
    na.value = "lightgray",
    name = "Liberal Democracy Rating"
  ) +
  labs(
    title = "World Liberal Democracy Rating: {closest_state}",
    caption = "Source: V-Dem Dataset v13"
  ) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
  axis.ticks = element_blank(),
    legend.position = "left",
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  ) +
  transition_states(
    year,
    transition_length = 1,
    state_length = 1
  ) +
  ease_aes("linear")

# Render to MP4 instead of GIF
animate(
  p,
  nframes = 200,
  fps = 10,
  width = 900,
  height = 600,
  renderer = av_renderer("world_libdem_rating_1960_2024.mp4")
)

```


